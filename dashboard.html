<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CRM San Isidro ‚Äî Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{
      --bg:#f8fafc;
      --card:#ffffff;
      --muted:#64748b;
      --text:#0f172a;
      --line:#e5e7eb;
      --gold:#C7A961;
      --ring:0 10px 30px rgba(0,0,0,.08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial;
         background:var(--bg); color:var(--text)}
    .container{max-width:1200px; margin:0 auto; padding:18px}
    /* top */
    .topbar{display:flex; align-items:center; justify-content:space-between; padding:6px 0 18px}
    .brand{display:flex; align-items:center; gap:10px}
    .brand .logo{width:22px; height:22px; color:var(--gold)}
    .brand b{font-size:22px}
    /* tabs */
    .tabs{display:flex; gap:6px; border-bottom:1px solid var(--line); margin-bottom:18px; flex-wrap:wrap}
    .tab{padding:10px 14px; border-radius:10px 10px 0 0; cursor:pointer; color:#374151; font-weight:600; border:1px solid transparent}
    .tab.active{background:var(--card); color:var(--text); box-shadow:0 -2px 0 var(--gold) inset; border-color:var(--line); border-bottom-color:var(--card)}
    /* cards */
    .cards{display:grid; grid-template-columns:repeat(4,1fr); gap:14px}
    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--ring)}
    .kpi{padding:16px}
    .kpi h4{margin:0 0 8px; font-size:13px; color:var(--muted)}
    .kpi .row{display:flex; align-items:center; justify-content:space-between}
    .kpi .val{font-size:28px; font-weight:800}
    .bar{height:6px; margin-top:8px; background:#f1f5f9; border-radius:8px; overflow:hidden}
    .bar > i{display:block; height:100%; background:var(--gold); width:40%}
    /* filters + table */
    .section{margin-top:14px}
    .section .head{display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid var(--line)}
    .head b{font-weight:800}
    .head .actions{display:flex; gap:8px; align-items:center}
    .filters{display:flex; gap:8px; padding:12px; align-items:center}
    .input,.btn{height:40px; padding:0 12px; border-radius:10px; border:1px solid var(--line); background:#fff; font-family:inherit}
    .input:focus{outline:none; border-color:#cbd5e1; box-shadow:0 0 0 3px rgba(199,169,97,.15)}
    .btn{cursor:pointer; font-weight:600}
    .btn.gold{background:var(--gold); color:#111; border:none}
    .btn.ghost{background:#fff}
    .tablewrap{overflow:auto}
    table{width:100%; border-collapse:separate; border-spacing:0}
    th,td{padding:12px 14px; border-bottom:1px solid #f1f5f9; text-align:left; font-size:14px}
    thead th{position:sticky; top:0; background:#fff; z-index:1}
    .badge{display:inline-flex; align-items:center; padding:3px 8px; border-radius:999px; font-size:12px; background:#ecfeff; color:#0e7490}
    /* modal */
    #overlay{position:fixed; inset:0; background:rgba(0,0,0,.45); backdrop-filter:blur(2px); z-index:9998; display:none}
    .modal{position:fixed; left:50%; top:5vh; transform:translateX(-50%); z-index:10000; isolation:isolate}
    .modal .card{width:min(900px,96vw); max-height:80vh; overflow:auto}
    body.modal-open{overflow:hidden}
    .form{display:grid; grid-template-columns:repeat(2,1fr); gap:12px; padding:16px}
    .form .full{grid-column:1/-1}
    .label{font-size:12px; color:var(--muted); margin-bottom:4px; display:block}
    .note{font-size:12px; color:var(--muted)}
    .suggest{position:absolute; left:0; right:0; top:100%; background:#fff; border:1px solid var(--line); border-radius:10px; box-shadow:var(--ring); margin-top:4px}
    .suggest li{list-style:none; padding:8px 10px; cursor:pointer}
    .suggest li:hover{background:#f8fafc}
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">
        <svg class="logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12h18"/><path d="M12 3v18"/>
        </svg>
        <b>CRM San Isidro</b>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="dashboard">Dashboard</button>
      <button class="tab" data-tab="accesos">Accesos</button>
      <button class="tab" data-tab="paqueteria">Paqueter√≠a</button>
      <button class="tab" data-tab="contable">Contable</button>
      <button class="tab" data-tab="config">Configuraci√≥n</button>
    </div>

    <!-- DASHBOARD -->
    <section id="view-dashboard">
      <div class="cards">
        <div class="card kpi"><h4>Total de Horas</h4><div class="row"><div class="val" id="kpiHoras">‚Äî</div><div>‚è±Ô∏è</div></div><div class="bar"><i id="barHoras"></i></div></div>
        <div class="card kpi"><h4>Usuarios Activos</h4><div class="row"><div class="val" id="kpiUsuarios">‚Äî</div><div>üë•</div></div></div>
        <div class="card kpi"><h4>Nuevos Registros</h4><div class="row"><div class="val" id="kpiNuevos">‚Äî</div><div>‚ûï</div></div></div>
        <div class="card kpi"><h4>Tasa de √âxito</h4><div class="row"><div class="val" id="kpiExito">‚Äî</div><div>‚úÖ</div></div><div class="bar"><i id="barExito" style="width:0%"></i></div></div>
      </div>

      <div class="card section" style="margin-top:14px">
        <div class="head">
          <b>Registros de Acceso</b>
          <div class="actions">
            <button class="btn gold" id="btnNuevoAcceso">Nuevo</button>
          </div>
        </div>
        <div class="filters">
          <input id="qAcc" class="input" placeholder="Buscar por nombre, DNI, patente, concepto‚Ä¶">
          <input id="dAccDesde" type="date" class="input">
          <input id="dAccHasta" type="date" class="input">
          <button id="bAccBuscar" class="btn gold">Buscar</button>
          <button id="bAccLimpiar" class="btn ghost">Limpiar</button>
        </div>
        <div class="tablewrap">
          <table>
            <thead><tr><th>NOMBRE</th><th>DNI</th><th>FECHA</th><th>HORA</th><th>ESTADO</th><th>ACCIONES</th></tr></thead>
            <tbody id="accRows"><tr><td colspan="6" style="padding:20px;color:#64748b">Cargando‚Ä¶</td></tr></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ACCESOS LISTA COMPLETA -->
    <section id="view-accesos" hidden>
      <div class="card section">
        <div class="head"><b>Accesos</b><div class="actions"><button class="btn gold" id="btnNuevoAcceso2">Nuevo</button></div></div>
        <div class="filters">
          <input id="qAcc2" class="input" placeholder="Buscar‚Ä¶">
          <input id="dAccDesde2" type="date" class="input">
          <input id="dAccHasta2" type="date" class="input">
          <button id="bAccBuscar2" class="btn gold">Buscar</button>
          <button id="bAccLimpiar2" class="btn ghost">Limpiar</button>
        </div>
        <div class="tablewrap">
          <table>
            <thead><tr><th>NOMBRE</th><th>DNI</th><th>VEH√çCULO</th><th>DOMINIO</th><th>Ingreso</th><th>Salida</th><th>Acciones</th></tr></thead>
            <tbody id="accRows2"><tr><td colspan="7" style="padding:20px;color:#64748b">Cargando‚Ä¶</td></tr></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- PAQUETERIA -->
    <section id="view-paqueteria" hidden>
      <div class="card section">
        <div class="head"><b>Paqueter√≠a</b><div class="actions"><button class="btn gold" id="btnNuevaPaq">Nuevo</button></div></div>
        <div class="filters">
          <input id="qPaq" class="input" placeholder="Buscar por receptor, entregado a, descripci√≥n‚Ä¶">
          <input id="dPaqDesde" type="date" class="input">
          <input id="dPaqHasta" type="date" class="input">
          <button id="bPaqBuscar" class="btn gold">Buscar</button>
          <button id="bPaqLimpiar" class="btn ghost">Limpiar</button>
        </div>
        <div class="tablewrap">
          <table>
            <thead><tr><th>RECEPTOR</th><th>EMPRESA</th><th>REMlTO</th><th>FECHA</th><th>ESTADO</th><th>ENTREGADO A</th><th>ACCIONES</th></tr></thead>
            <tbody id="paqRows"><tr><td colspan="7" style="padding:20px;color:#64748b">Cargando‚Ä¶</td></tr></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- placeholders  -->
    <section id="view-contable" hidden><div class="card" style="padding:20px">Contable (se mantiene tu implementaci√≥n).</div></section>
    <section id="view-config"   hidden><div class="card" style="padding:20px">Configuraci√≥n.</div></section>

  </div>

  <!-- Modal infra -->
  <div id="overlay"></div>
  <div class="modal" id="modal" hidden>
    <div class="card">
      <div class="head"><b id="modalTitle">Nuevo</b><div class="actions"><button class="btn ghost" id="btnCerrar">Cerrar</button></div></div>
      <div class="form" id="formArea"></div>
      <div class="filters" style="justify-content:flex-end">
        <button class="btn ghost" id="btnCancelar">Cancelar</button>
        <button class="btn gold" id="btnGuardar">Guardar</button>
      </div>
    </div>
  </div>

<script>
// === SUPABASE CONFIG ===
const SUPABASE_URL = window.SUPABASE_URL || "https://YOUR-PROJECT.supabase.co";
const SUPABASE_KEY = window.SUPABASE_KEY || "YOUR-ANON-KEY";
const sb = window.sb || supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// === helpers ===
const $ = (s,root=document)=>root.querySelector(s);
const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));
const fmt = new Intl.NumberFormat('es-AR'); const fmtPct = new Intl.NumberFormat('es-AR',{style:'percent', maximumFractionDigits:0});
function startOfWeek(d=new Date()){ const n=new Date(d); const day=(n.getDay()+6)%7; n.setDate(n.getDate()-day); n.setHours(0,0,0,0); return n; }
function between(dateStr, from, to){ if(!dateStr) return true; const t = new Date(dateStr); return (!from || t>=from) && (!to || t<=to); }
function debounce(fn, delay){ let t; return (...a)=>{clearTimeout(t); t=setTimeout(()=>fn(...a), delay);} }
function esc(s){ return (s??'').toString().replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

// tabs
$$('.tab').forEach(b=>b.addEventListener('click',()=>{
  $$('.tab').forEach(x=>x.classList.remove('active')); b.classList.add('active');
  const t = b.dataset.tab;
  ['dashboard','accesos','paqueteria','contable','config'].forEach(x=> $('#view-'+x).hidden = (x!==t));
}));

// === KPIs ===
async function loadKPIs(){
  const startW = startOfWeek();
  const { data: acc } = await sb.from('accesos').select('user_id, created_at, f_ing, h_ing, f_sal, h_sal');
  const { data: paq } = await sb.from('paqueteria').select('user_id, created_at, receptor, entregado_a');
  // usuarios activos (7 d√≠as)
  const active = new Set([...(acc||[]), ...(paq||[])].filter(r => new Date(r.created_at) >= new Date(Date.now()-7*86400000)).map(r=>r.user_id).filter(Boolean));
  $('#kpiUsuarios').textContent = active.size;
  // nuevos registros (semana)
  const nuevos = [...(acc||[]), ...(paq||[])].filter(r => new Date(r.created_at)>=startW).length;
  $('#kpiNuevos').textContent = fmt.format(nuevos);
  // horas
  let mins=0; (acc||[]).forEach(r=>{
    if(r.f_ing && r.h_ing && r.f_sal && r.h_sal){
      const ini = new Date(r.f_ing+'T'+r.h_ing); const fin = new Date(r.f_sal+'T'+r.h_sal);
      const diff = (fin-ini)/60000; if (diff>0 && diff<24*60) mins += diff;
    }
  });
  const horas = Math.round(mins/60); $('#kpiHoras').textContent = fmt.format(horas); $('#barHoras').style.width = Math.min(100, horas%100)+'%';
  // exito
  const total = (acc?.length||0) + (paq?.length||0) || 1;
  const completosAcc = (acc||[]).filter(r=>r.nombre && r.dni).length;
  const completosPaq = (paq||[]).filter(r=>r.receptor && r.entregado_a).length;
  const exito = (completosAcc+completosPaq)/total;
  $('#kpiExito').textContent = fmtPct.format(exito); $('#barExito').style.width = Math.round(exito*100)+'%';
}

// === LISTADOS ===
async function loadAccesos(target='accRows'){
  const q = $('#'+(target==='accRows'?'qAcc':'qAcc2')).value.trim().toLowerCase();
  const dDesde = $('#'+(target==='accRows'?'dAccDesde':'dAccDesde2')).value ? new Date($('#'+(target==='accRows'?'dAccDesde':'dAccDesde2')).value) : null;
  const dHasta = $('#'+(target==='accRows'?'dAccHasta':'dAccHasta2')).value ? new Date($('#'+(target==='accRows'?'dAccHasta':'dAccHasta2')).value+"T23:59:59") : null;
  const { data } = await sb.from('accesos').select('*').order('created_at', { ascending:false }).limit(1000);
  const rows = (data||[]).filter(r=>{
    const text = [r.nombre,r.dni,r.vehiculo,r.dominio,r.motivo].filter(Boolean).join(' ').toLowerCase();
    const passQ = !q || text.includes(q);
    const passD = between(r.f_ing || r.created_at, dDesde, dHasta);
    return passQ && passD;
  }).map(r=>{
    const estado = (r.f_sal && r.h_sal) ? '<span class="badge">Completado</span>' : '<span class="badge" style="background:#fff7ed;color:#b45309">En curso</span>';
    if (target==='accRows') {
      return `<tr><td>${esc(r.nombre)}</td><td>${esc(r.dni)}</td><td>${esc(r.f_ing||'')}</td><td>${esc(r.h_ing||'')}</td><td>${estado}</td>
              <td><button class="btn ghost" onclick="editAcceso('${r.id}')">‚úèÔ∏è</button></td></tr>`;
    } else {
      const ing = (r.f_ing||'')+' '+(r.h_ing||'');
      const sal = (r.f_sal||'')+' '+(r.h_sal||'');
      return `<tr><td>${esc(r.nombre)}</td><td>${esc(r.dni)}</td><td>${esc(r.vehiculo||'')}</td><td>${esc(r.dominio||'')}</td>
              <td>${esc(ing)}</td><td>${esc(sal)}</td><td><button class="btn ghost" onclick="editAcceso('${r.id}')">‚úèÔ∏è</button></td></tr>`;
    }
  }).join('');
  $('#'+target).innerHTML = rows || '<tr><td colspan="'+(target==='accRows'?6:7)+'" style="padding:20px;color:#64748b">Sin resultados</td></tr>';
}
async function loadPaqueteria(){
  const q = $('#qPaq').value.trim().toLowerCase();
  const dDesde = $('#dPaqDesde').value ? new Date($('#dPaqDesde').value) : null;
  const dHasta = $('#dPaqHasta').value ? new Date($('#dPaqHasta').value+"T23:59:59") : null;
  const { data } = await sb.from('paqueteria').select('*').order('created_at', { ascending:false }).limit(1000);
  const rows = (data||[]).filter(r=>{
    const text = [r.receptor, r.entregado_a, r.descripcion, r.id_num, r.empresa].filter(Boolean).join(' ').toLowerCase();
    const passQ = !q || text.includes(q);
    const passD = between(r.fecha || r.created_at, dDesde, dHasta);
    return passQ && passD;
  }).map(r=>{
    const estado = r.estado || 'Pendiente';
    return `<tr><td>${esc(r.receptor||'')}</td><td>${esc(r.empresa||'')}</td><td>${esc(r.remito||'')}</td><td>${esc(r.fecha||'')}</td>
            <td><span class="badge">${esc(estado)}</span></td><td>${esc(r.entregado_a||'')}</td>
            <td><button class="btn ghost" onclick="editPaq('${r.id}')">‚úèÔ∏è</button></td></tr>`;
  }).join('');
  $('#paqRows').innerHTML = rows || '<tr><td colspan="7" style="padding:20px;color:#64748b">Sin resultados</td></tr>';
}

// === MODAL CRUD B√ÅSICO + AUTOCOMPLETE ===
const overlay = $('#overlay'); const modal = $('#modal'); const formArea = $('#formArea'); const modalTitle = $('#modalTitle');
function openModal(){ overlay.style.display='block'; document.body.classList.add('modal-open'); modal.hidden=false; }
function closeModal(){ overlay.style.display='none'; document.body.classList.remove('modal-open'); modal.hidden=true; formArea.innerHTML=''; }
$('#btnCerrar').onclick = closeModal; $('#btnCancelar').onclick = closeModal;

function attachAutocomplete(inputEl, provider){
  let wrap;
  inputEl.setAttribute('autocomplete','off');
  function ensure(){
    if (wrap) return; wrap = document.createElement('ul'); wrap.className='suggest'; inputEl.parentElement.style.position='relative'; inputEl.parentElement.appendChild(wrap);
  }
  const update = debounce(async ()=>{
    const q = inputEl.value.trim(); if (!q){ if(wrap) wrap.innerHTML=''; return; }
    ensure(); const items = await provider(q); if (!items.length){ wrap.innerHTML=''; return; }
    wrap.innerHTML = items.map(v=>`<li>${esc(v)}</li>`).join('');
    wrap.querySelectorAll('li').forEach(li=> li.addEventListener('click', ()=>{ inputEl.value = li.textContent.replace(/ ‚Äî DNI .*/, ''); wrap.innerHTML=''; }));
  }, 200);
  inputEl.addEventListener('input', update);
  inputEl.addEventListener('blur', ()=> setTimeout(()=>{ if(wrap) wrap.innerHTML=''; }, 150));
}
async function suggestFromPersonas(prefix){
  const { data, error } = await sb.from('personas').select('nombre,dni').ilike('nombre', prefix+'%').order('nombre').limit(8);
  if (error) return []; return (data||[]).map(p=> p.dni ? `${p.nombre} ‚Äî DNI ${p.dni}` : p.nombre);
}

async function ensurePersona(nombre, dni){
  if(!nombre && !dni) return;
  let q = sb.from('personas').select('id').limit(1);
  if (dni) q = q.or(`dni.eq.${dni},nombre.eq.${nombre||''}`); else q = q.eq('nombre', nombre);
  const { data: found, error: e1 } = await q;
  if (!e1 && found && found.length) return;
  await sb.from('personas').insert({ nombre: nombre||null, dni: dni||null });
}

function field(label, id, type='text', cls=''){
  return `<div class="${cls}"><label class="label">${label}</label><div style="position:relative"><input id="${id}" type="${type}" class="input" /></div></div>`;
}

// Accesos
async function nuevoAcceso(data=null){
  modalTitle.textContent = data? 'Editar Acceso' : 'Nuevo Acceso';
  formArea.innerHTML = [
    field('Nombre','f_nombre'),
    field('DNI','f_dni'),
    field('Veh√≠culo','f_vehiculo'),
    field('Dominio','f_dominio'),
    field('Motivo','f_motivo','text','full'),
    field('Fecha Ingreso','f_fing','date'),
    field('Hora Ingreso','f_hing','time'),
    field('Fecha Salida','f_fsal','date'),
    field('Hora Salida','f_hsal','time')
  ].join('');
  if (data){
    $('#f_nombre').value = data.nombre||''; $('#f_dni').value = data.dni||''; $('#f_vehiculo').value = data.vehiculo||''; $('#f_dominio').value = data.dominio||'';
    $('#f_motivo').value = data.motivo||''; $('#f_fing').value = data.f_ing||''; $('#f_hing').value = data.h_ing||''; $('#f_fsal').value = data.f_sal||''; $('#f_hsal').value = data.h_sal||'';
  }
  attachAutocomplete($('#f_nombre'), suggestFromPersonas);
  attachAutocomplete($('#f_dni'), async(p)=>{ const s=await sb.from('personas').select('dni').ilike('dni', p+'%').limit(8); return (s.data||[]).map(x=>x.dni); });
  $('#btnGuardar').onclick = async ()=>{
    const payload = {
      nombre: $('#f_nombre').value.trim(), dni: $('#f_dni').value.trim(),
      vehiculo: $('#f_vehiculo').value.trim(), dominio: $('#f_dominio').value.trim(), motivo: $('#f_motivo').value.trim(),
      f_ing: $('#f_fing').value||null, h_ing: $('#f_hing').value||null, f_sal: $('#f_fsal').value||null, h_sal: $('#f_hsal').value||null
    };
    if (data?.id){ await sb.from('accesos').update(payload).eq('id', data.id); } else { await sb.from('accesos').insert(payload); }
    await ensurePersona(payload.nombre, payload.dni);
    closeModal(); loadKPIs(); loadAccesos('accRows'); loadAccesos('accRows2');
  };
  openModal();
}
async function editAcceso(id){ const { data } = await sb.from('accesos').select('*').eq('id', id).single(); await nuevoAcceso(data); }

// Paqueter√≠a
async function nuevaPaq(data=null){
  modalTitle.textContent = data? 'Editar Paqueter√≠a' : 'Nueva Paqueter√≠a';
  formArea.innerHTML = [
    field('Receptor','p_receptor'),
    field('Empresa','p_empresa'),
    field('Remito','p_remito'),
    field('Estado','p_estado'),
    field('Fecha','p_fecha','date'),
    field('Hora','p_hora','time'),
    field('Descripci√≥n','p_desc','text','full'),
    field('ID N¬∫','p_idnum'),
    field('Entregado a','p_entrega'),
    field('Fecha Entrega','p_fent','date'),
    field('Hora Entrega','p_hent','time'),
    field('Notas','p_notas','text','full')
  ].join('');
  if (data){
    ['receptor','empresa','remito','estado','fecha','hora','descripcion','id_num','entregado_a','fecha_entrega','hora_entrega','notas'].forEach(k=>{
      const map = {descripcion:'p_desc', id_num:'p_idnum', entregado_a:'p_entrega', fecha_entrega:'p_fent', hora_entrega:'p_hent'};
      const id = map[k] || 'p_'+k; const el = $('#'+id); if (el) el.value = data[k]||'';
    });
  }
  attachAutocomplete($('#p_receptor'), suggestFromPersonas);
  attachAutocomplete($('#p_entrega'), suggestFromPersonas);
  $('#btnGuardar').onclick = async ()=>{
    const payload = {
      receptor: $('#p_receptor').value.trim(), empresa: $('#p_empresa').value.trim(), remito: $('#p_remito').value.trim(),
      estado: $('#p_estado').value.trim(), fecha: $('#p_fecha').value||null, hora: $('#p_hora').value||null,
      descripcion: $('#p_desc').value.trim(), id_num: $('#p_idnum').value.trim(), entregado_a: $('#p_entrega').value.trim(),
      fecha_entrega: $('#p_fent').value||null, hora_entrega: $('#p_hent').value||null, notas: $('#p_notas').value.trim()
    };
    if (data?.id){ await sb.from('paqueteria').update(payload).eq('id', data.id); } else { await sb.from('paqueteria').insert(payload); }
    await ensurePersona(payload.receptor, null); await ensurePersona(payload.entregado_a, null);
    closeModal(); loadKPIs(); loadPaqueteria();
  };
  openModal();
}
async function editPaq(id){ const { data } = await sb.from('paqueteria').select('*').eq('id', id).single(); await nuevaPaq(data); }

// eventos UI
$('#bAccBuscar').onclick = ()=> loadAccesos('accRows');
$('#bAccLimpiar').onclick = ()=>{ $('#qAcc').value=''; $('#dAccDesde').value=''; $('#dAccHasta').value=''; loadAccesos('accRows'); };
$('#bAccBuscar2').onclick = ()=> loadAccesos('accRows2');
$('#bAccLimpiar2').onclick = ()=>{ $('#qAcc2').value=''; $('#dAccDesde2').value=''; $('#dAccHasta2').value=''; loadAccesos('accRows2'); };
$('#bPaqBuscar').onclick = loadPaqueteria;
$('#bPaqLimpiar').onclick = ()=>{ $('#qPaq').value=''; $('#dPaqDesde').value=''; $('#dPaqHasta').value=''; loadPaqueteria(); };

$('#btnNuevoAcceso').onclick = ()=> nuevoAcceso();
$('#btnNuevoAcceso2').onclick = ()=> nuevoAcceso();
$('#btnNuevaPaq').onclick = ()=> nuevaPaq();

// init
window.addEventListener('load', async ()=>{
  await loadKPIs();
  await loadAccesos('accRows'); await loadAccesos('accRows2'); await loadPaqueteria();
});
</script>
</body>
</html>
