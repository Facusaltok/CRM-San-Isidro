<!DOCTYPE html>
<html lang="es">
<head>
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CRM — San Isidro</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap');
  
  :root { 
    --primary: #4f46e5; /* indigo-600 */
    --primary-light: #818cf8; /* indigo-300 */
    --secondary: #0ea5e9; /* sky-500 */
    --secondary-light: #38bdf8; /* sky-400 */
    --accent: #ec4899; /* pink-500 */
    --accent-light: #f472b6; /* pink-400 */
    --success: #10b981; /* emerald-500 */
    --warning: #f59e0b; /* amber-500 */
    --danger: #ef4444; /* red-500 */
    --dark: #1e293b; /* slate-800 */
    --gray: #64748b; /* slate-500 */
    --light: #f8fafc; /* slate-50 */
    --white: #ffffff;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    --radius: 12px; /* ligeramente más pequeño para un toque moderno */
    --radius-lg: 20px; /* ligeramente más pequeño para un toque moderno */
  }
  
  * {
    box-sizing: border-box;
  }
  
  body { 
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    color: var(--dark);
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
    line-height: 1.6;
  }
  
  /* Efectos de fondo sutiles */
  .bg-pattern {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
      radial-gradient(circle at 10% 20%, rgba(79, 70, 229, 0.03) 0%, transparent 50%),
      radial-gradient(circle at 90% 80%, rgba(14, 165, 233, 0.03) 0%, transparent 50%);
    z-index: -1;
  }
  
  .accent-shape {
    position: fixed;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.1) 0%, rgba(14, 165, 233, 0.1) 100%);
    filter: blur(40px);
    z-index: -1;
  }
  
  .accent-shape-1 {
    width: 500px;
    height: 500px;
    top: -200px;
    right: -100px;
    animation: float 8s ease-in-out infinite;
  }
  
  .accent-shape-2 {
    width: 400px;
    height: 400px;
    bottom: -150px;
    left: -100px;
    background: linear-gradient(135deg, rgba(236, 72, 153, 0.1) 0%, rgba(14, 165, 233, 0.1) 100%);
    animation: float 10s reverse ease-in-out infinite;
  }

  @keyframes float {
    0% { transform: translate(0, 0); }
    50% { transform: translate(10px, 10px); }
    100% { transform: translate(0, 0); }
  }
  
  /* Contenedor principal */
  .main-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 24px;
  }
  
  /* Header mejorado */
  header {
    background: linear-gradient(135deg, var(--white) 0%, #f8fafc 100%);
    border-bottom: 1px solid rgba(226, 232, 240, 0.8);
    box-shadow: var(--shadow-md); /* Sombra más pronunciada */
    backdrop-filter: blur(10px);
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  
  .logo-container {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: var(--radius);
    box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .logo-container:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 15px 20px -5px rgba(79, 70, 229, 0.4);
  }
  
  /* Leyenda de seguridad */
  .secure-badge { 
    display: flex; 
    align-items: center; 
    gap: 0.75rem; 
    padding: 1rem 1.5rem; 
    border: 1px solid rgba(79, 70, 229, 0.2); 
    border-radius: var(--radius-lg); /* Bordes más suaves */
    background: linear-gradient(180deg, var(--white), #f0f9ff);
    margin-bottom: 2rem;
    box-shadow: var(--shadow-md); /* Sombra más notable */
    transition: all 0.3s ease;
  }

  .secure-badge:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }
  
  .lock { 
    width: 28px; /* Tamaño ligeramente mayor */
    height: 28px; 
    border: 2px solid var(--primary); 
    border-radius: 6px; 
    position: relative;
    animation: rotateLock 4s linear infinite; /* Animación sutil */
  }

  @keyframes rotateLock {
    0% { transform: rotate(0deg); }
    50% { transform: rotate(5deg); }
    100% { transform: rotate(0deg); }
  }
  
  .lock:before { 
    content: ""; 
    position: absolute; 
    left: 50%; 
    transform: translateX(-50%); 
    top: -12px; /* Ajuste de posición */
    width: 14px; /* Tamaño ligeramente mayor */
    height: 12px; 
    border: 2px solid var(--primary); 
    border-bottom: none; 
    border-radius: 12px 12px 0 0;
  }
  
  .pulse { 
    animation: pulse 2s ease-in-out infinite;
  }
  
  @keyframes pulse { 
    0% { opacity: 1; } 
    50% { opacity: 0.7; } /* pulso más suave */
    100% { opacity: 1; } 
  }

  /* Navegación */
  .nav-container {
    display: flex;
    gap: 0.75rem; /* Espaciado un poco mayor */
    margin-bottom: 2rem;
    overflow-x: auto;
    padding-bottom: 0.75rem; /* Más padding para scroll */
    -webkit-overflow-scrolling: touch; /* smooth scrolling en iOS */
  }
  
  .tab {
    padding: 1rem 1.75rem; /* Más padding */
    border-radius: var(--radius);
    border: 1px solid transparent;
    background: var(--white);
    color: var(--gray);
    transition: all 0.3s ease;
    font-weight: 600;
    font-size: 1rem; /* Tamaño de fuente ligeramente mayor */
    white-space: nowrap;
    box-shadow: var(--shadow-md); /* Sombra más pronunciada */
    display: flex;
    align-items: center;
    gap: 0.75rem; /* Espaciado de icono */
  }
  
  .tab:hover { 
    background: var(--light);
    color: var(--dark);
    transform: translateY(-3px) scale(1.01); /* Efecto más pronunciado */
    box-shadow: var(--shadow-lg);
  }
  
  .tab.active { 
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: var(--white);
    border-color: transparent;
    box-shadow: 0 12px 20px -5px rgba(79, 70, 229, 0.4); /* Sombra más destacada */
    transform: translateY(-3px) scale(1.01);
  }
  
  /* Sub-pestañas */
  .sub-tabs-container {
    display: flex;
    gap: 1rem; /* Mayor espacio */
    margin-bottom: 1.75rem; /* Mayor margen */
  }
  
  .sub-tab {
    padding: 0.75rem 1.35rem; /* Más padding */
    border-radius: var(--radius);
    border: 1px solid rgba(226, 232, 240, 0.8);
    background: var(--white);
    color: var(--gray);
    transition: all 0.3s ease;
    font-weight: 600;
    font-size: 0.9rem; /* Tamaño de fuente ligeramente mayor */
    display: flex;
    align-items: center;
    gap: 0.6rem; /* Espaciado de icono */
    box-shadow: var(--shadow);
  }
  
  .sub-tab:hover {
    background: var(--light);
    color: var(--dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }
  
  .sub-tab.active {
    background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
    color: var(--white);
    border-color: transparent;
    box-shadow: 0 10px 15px -3px rgba(14, 165, 233, 0.35); /* Sombra más destacada */
  }
  
  .tab-count {
    background: rgba(255, 255, 255, 0.35); /* Fondo más visible */
    border-radius: 999px;
    padding: 0.15rem 0.6rem; /* Más padding */
    font-size: 0.8rem;
    font-weight: 700;
    min-width: 28px; /* Para que el círculo no sea demasiado pequeño */
    text-align: center;
  }
  
  /* Filtros */
  .filters-container {
    background: var(--white);
    border-radius: var(--radius-lg);
    padding: 2.5rem; /* Más padding */
    box-shadow: var(--shadow-lg);
    margin-bottom: 2.5rem; /* Más margen */
  }
  
  /* KPIs */
  .kpi-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.75rem; /* Más espacio */
    margin-bottom: 2.5rem; /* Más margen */
  }
  
  .kpi {
    background: var(--white);
    border-radius: var(--radius-lg);
    padding: 2rem; /* Más padding */
    box-shadow: var(--shadow-md);
    transition: all 0.4s ease;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
  }
  
  .kpi::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 5px; /* Línea más gruesa */
    background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent)); /* Gradiente de 3 colores */
    animation: kpiLine 3s linear infinite;
    background-size: 200% 100%;
  }

  @keyframes kpiLine {
    0% { background-position: 100% 0; }
    100% { background-position: -100% 0; }
  }
  
  .kpi:hover {
    transform: translateY(-8px); /* Elevación más pronunciada */
    box-shadow: var(--shadow-xl);
  }
  
  .kpi-icon {
    width: 68px; /* Tamaño ligeramente mayor */
    height: 68px;
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem; /* Tamaño de icono mayor */
    margin-bottom: 1.5rem; /* Más margen */
    box-shadow: var(--shadow);
  }
  
  .kpi-title {
    font-size: 0.9rem; /* Tamaño de fuente ligeramente mayor */
    color: var(--gray);
    margin-bottom: 0.6rem;
    font-weight: 700; /* Más negrita */
    text-transform: uppercase;
    letter-spacing: 0.08em; /* Mayor espaciado */
  }
  
  .kpi-value {
    font-size: 2.5rem; /* Tamaño de fuente mayor */
    font-weight: 800; /* Más negrita */
    line-height: 1.1;
    margin-top: auto;
  }
  
  /* Tabla */
  .table-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    transition: all 0.4s ease;
    margin-bottom: 2.5rem; /* Más margen */
  }
  
  .table-card:hover {
    transform: translateY(-6px); /* Elevación más pronunciada */
    box-shadow: var(--shadow-xl);
  }
  
  .table-card-header {
    padding: 2rem 2.25rem; /* Más padding */
    border-bottom: 1px solid rgba(226, 232, 240, 0.8);
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    display: flex; /* Para mejor alineación de título e info */
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }
  
  .table-card-title {
    font-size: 1.5rem; /* Tamaño de fuente mayor */
    font-weight: 800; /* Más negrita */
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 1.25rem; /* Más espacio */
  }
  
  .table-card-icon {
    width: 60px; /* Tamaño ligeramente mayor */
    height: 60px;
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem; /* Tamaño de icono mayor */
    box-shadow: var(--shadow);
  }
  
  .table-wrap {
    max-height: 65vh;
    overflow: auto;
    scroll-behavior: smooth; /* Desplazamiento suave */
  }
  
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }
  
  th {
    padding: 1.15rem 1.5rem; /* Más padding */
    text-align: left;
    font-weight: 700;
    color: var(--dark);
    border-bottom: 1px solid rgba(226, 232, 240, 0.8);
    text-transform: uppercase;
    font-size: 0.8rem; /* Tamaño de fuente ligeramente mayor */
    letter-spacing: 0.08em; /* Mayor espaciado */
    background: var(--light);
    position: sticky;
    top: 0;
    z-index: 1; /* Para que los encabezados se queden arriba */
  }
  
  td {
    padding: 1.15rem 1.5rem; /* Más padding */
    border-bottom: 1px solid rgba(226, 232, 240, 0.5);
    vertical-align: middle; /* Alineación vertical central */
  }
  
  tr:hover td {
    background: rgba(79, 70, 229, 0.05); /* Color de hover más notorio */
  }
  
  /* Estados */
  .status-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.4rem 0.95rem; /* Más padding */
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 700;
    text-transform: capitalize; /* Capitalizar la primera letra */
  }
  
  .status-success {
    background: rgba(16, 185, 129, 0.15); /* Más opacidad */
    color: var(--success);
  }
  
  .status-warning {
    background: rgba(245, 158, 11, 0.15);
    color: var(--warning);
  }
  
  .status-danger {
    background: rgba(239, 68, 68, 0.15);
    color: var(--danger);
  }
  
  .status-info {
    background: rgba(14, 165, 233, 0.15);
    color: var(--secondary);
  }
  
  /* Botones */
  .btn {
    padding: 0.85rem 1.65rem; /* Más padding */
    border-radius: var(--radius);
    border: 1px solid rgba(226, 232, 240, 0.8);
    background: var(--white);
    transition: all 0.3s ease;
    font-weight: 600;
    box-shadow: var(--shadow);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem; /* Tamaño de fuente ligeramente mayor */
    cursor: pointer;
  }
  
  .btn:hover { 
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    background: var(--light);
  }
  
  .btn-primary {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: var(--white);
    border-color: transparent;
    box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.35);
  }
  
  .btn-primary:hover { 
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary-light) 100%);
    transform: translateY(-3px);
    box-shadow: 0 15px 20px -5px rgba(79, 70, 229, 0.45);
  }

  .btn-danger {
    background: var(--danger);
    color: var(--white);
    border-color: transparent;
    box-shadow: 0 8px 12px rgba(239, 68, 68, 0.25);
  }
  
  .btn-danger:hover {
    background: #dc2626;
    transform: translateY(-2px);
    box-shadow: 0 10px 15px rgba(239, 68, 68, 0.35);
  }
  
  /* Formularios */
  .input {
    width: 100%;
    padding: 0.95rem 1.35rem; /* Más padding */
    border: 1px solid rgba(226, 232, 240, 0.8);
    border-radius: var(--radius);
    outline: none;
    transition: all 0.3s ease;
    background: var(--white);
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--dark);
  }
  
  .input:focus { 
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.18); /* Sombra de foco más prominente */
  }
  
  .label {
    display: block;
    font-size: 0.9rem; /* Tamaño de fuente ligeramente mayor */
    color: var(--gray);
    margin-bottom: 0.6rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  /* Sugerencias de autocompletado */
  .suggest {
    position: absolute;
    top: 100%; /* debajo del input */
    left: 0;
    right: 0;
    background: var(--white);
    border: 1px solid rgba(226, 232, 240, 0.8);
    border-radius: 0 0 var(--radius) var(--radius);
    box-shadow: var(--shadow-md);
    max-height: 200px;
    overflow-y: auto;
    z-index: 10;
  }

  .suggest li {
    padding: 0.8rem 1.2rem;
    cursor: pointer;
    transition: background-color 0.2s ease;
    border-bottom: 1px solid rgba(226, 232, 240, 0.4);
  }

  .suggest li:last-child {
    border-bottom: none;
  }

  .suggest li:hover {
    background-color: var(--light);
    color: var(--dark);
  }
  
  /* Modal */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(15, 23, 42, 0.85); /* Fondo más oscuro */
    backdrop-filter: blur(10px); /* Blur más intenso */
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.4s ease, visibility 0.4s ease;
  }
  
  .modal.show {
    opacity: 1;
    visibility: visible;
  }
  
  .modal > div {
    background: var(--white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-xl);
    max-width: 90%;
    width: 1200px;
    max-height: 90vh;
    overflow: hidden;
    transform: translateY(40px) scale(0.98); /* Inicio de animación más alejado y pequeño */
    transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.4, 1.2), opacity 0.4s ease; /* Easing con bounce */
    z-index: 10000;
    display: flex;
    flex-direction: column;
    position: relative;
  }
  
  .modal.show > div {
    transform: translateY(0) scale(1);
  }

  .modal-header, .modal-footer {
    padding: 1.5rem 2.25rem;
    flex-shrink: 0; /* Para que no se encojan */
  }

  .modal-body {
    padding: 0 2.25rem;
    flex-grow: 1; /* Para que ocupe el espacio restante */
    overflow-y: auto;
    scroll-behavior: smooth;
  }

  .modal-footer-shadow {
    border-top: 1px solid rgba(226, 232, 240, 0.8);
    box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05); /* Sombra en el footer */
  }

  /* Secciones colapsables */
  .section {
    border: 1px solid rgba(226, 232, 240, 0.8);
    border-radius: var(--radius-lg); /* Bordes más suaves */
    box-shadow: var(--shadow-md);
    overflow: hidden;
    transition: all 0.4s ease;
